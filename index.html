<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AniLabs</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;background:#070b18;color:#fff;font-family:system-ui}
.header{display:flex;align-items:center;gap:12px;padding:16px;font-size:20px}
.header img{width:42px;height:42px;border-radius:50%}
.chat{padding:16px;padding-bottom:140px}
.msg{max-width:80%;padding:10px 14px;border-radius:16px;margin-bottom:10px;
opacity:0;transform:translateY(8px);animation:fade .3s forwards}
.user{background:#6ee7ff;color:#000;margin-left:auto}
.bot{background:#1a1f3c}
@keyframes fade{to{opacity:1;transform:none}}
.input{position:fixed;bottom:0;left:0;right:0;display:flex;padding:10px;background:#0a0e28}
input{flex:1;padding:12px;border-radius:12px;border:none}
button{margin-left:8px;padding:12px 18px;border-radius:12px;border:none}
</style>
</head>

<body>

<div class="header">
  <img src="https://i.imgur.com/6Z8FJ9M.png">
  <span>Риас Гремори</span>
</div>

<div class="chat" id="chat"></div>

<div class="input">
  <input id="text" placeholder="Сообщение...">
  <button onclick="send()">➤</button>
</div>

<script>
const API = "/chat";
let tokens = 2;

function add(text, cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=text;
  chat.appendChild(d);
  d.scrollIntoView({behavior:"smooth"});
}

async function send(){
  const t=text.value.trim();
  if(!t) return;

  if(tokens<=0){
    add("❌ Недостаточно токенов","bot");
    return;
  }

  add(t,"user");
  text.value="";
  tokens--;

  try{
    const r=await fetch(API,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({character:"Риас Гремори",message:t})
    });
    const j=await r.json();
    add(j.reply,"bot");
  }catch{
    add("⏳ Сервер недоступен","bot");
  }
}
</script>

</body>
</html>
