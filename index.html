<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Story App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { background:#0f0f0f; color:white; font-family:sans-serif; margin:0 }
#chat { height:90vh; overflow-y:auto; padding:10px }
.msg { margin:8px 0 }
.user { text-align:right; color:#4fc3f7 }
.bot { text-align:left; color:#ffb74d }
#input { display:flex }
input { flex:1; padding:10px }
button { padding:10px }
</style>
</head>
<body>

<div id="chat"></div>

<div id="input">
<input id="text" placeholder="Напиши действие или реплику...">
<button onclick="send()">▶</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const userId = tg.initDataUnsafe.user.id;
const chat = document.getElementById("chat");

function add(text, cls){
  let d = document.createElement("div");
  d.className = "msg " + cls;
  d.innerText = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

async function send(){
  const text = document.getElementById("text").value;
  if(!text) return;
  add(text,"user");
  document.getElementById("text").value="";

  const r = await fetch("http://YOUR_SERVER_IP:8000/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      user_id:userId,
      message:text
    })
  });
  const j = await r.json();
  add(j.reply,"bot");
}
</script>
</body>
</html>
